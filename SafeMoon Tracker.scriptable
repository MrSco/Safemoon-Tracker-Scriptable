{
  "always_run_in_app" : false,
  "icon" : {
    "color" : "teal",
    "glyph" : "user-astronaut"
  },
  "name" : "SafeMoon Tracker",
  "script" : "let widgetParams = (args.widgetParameter || '').split('|')\nlet friendlyName = 'SafeMoon'\nconst settings = {\n  BSCSCAN_API_KEY: widgetParams[0] || 'C524VST55HHQZN4A614DZB515D8P1PW86X', \/\/ WAP bscscan account api key\n  WALLET_ADDRESS: widgetParams[1] || '0x8c128dba2cb66399341aa877315be1054be75da8',\n  WIDGET_URL: 'https:\/\/safemoon.net',\n  LOGO_URL: 'https:\/\/safemoon.net\/img\/174x174.png',\n  FRIENDLY_NAME: friendlyName,\n  CURRENCY_PAIR: (friendlyName).toUpperCase() + '_USDT',\n  CONTRACT_ADDRESS: '0x8076c74c5e3f5852037f31ff0093eeb8c8add8d3',\n  TICKER_API_URL: 'https:\/\/data.gateio.life\/api2\/1\/ticker',\n  KLINE_API_URL: 'https:\/\/data.gateapi.io\/api2\/1\/candlestick2\/{0}?group_sec=60&range_hour=1',\n  BSCSCAN_API_URL: 'https:\/\/api.bscscan.com\/api?module=account&action=tokenbalance&contractaddress={0}&address={1}&tag=latest&apikey={2}',\n  CHART_API_URL: 'https:\/\/quickchart.io\/chart?w=100&h=50&c=',\n  CHART_URL: 'https:\/\/poocoin.app\/tokens\/',\n  PRICE_FACTOR: 0.000000001\n};\nconst imgReq = new Request(settings.LOGO_URL)\nconst tokenImg = await imgReq.loadImage()\n\/\/ ************************************\n\/\/ execute widget\nlet widget = await createWidget()\nif (config.runsInWidget) {\n  Script.setWidget(widget)\n} else {\n  widget.presentMedium()\n}\nScript.complete()\n\/\/ ************************************\nasync function createWidget() {\n  \/\/ declare widget\n  let w = new ListWidget()\n  \/\/ call async request to fetch wallet amount\n  let tokenInfo = await getBalance()\n  let balance = tokenInfo['balance']\n  let walletBalance = tokenInfo['walletBalance'].toFixed(4)\n  let price = tokenInfo['last']\n  let percentChange = tokenInfo['percentChange']\n  \/\/background color\n  w.backgroundColor = new Color('#000000')\n  \/\/ **************************************\n  \/\/ MAIN CONTAINER\n  let mainContainerStack = w.addStack()\n  \/\/ TOP CONTAINER\n  let leftContainerStack = mainContainerStack.addStack()\n  leftContainerStack.layoutVertically()\n  leftContainerStack.size = new Size(275, 150)\n  \/\/ TOP RIGHT STACK\n  let rightContainerStack = mainContainerStack.addStack()\n  rightContainerStack.size = new Size(40, 140)\n  rightContainerStack.bottomAlignContent()\n  \/\/ TOP LEFT STACK:\n  \/\/ **************************************\n  \/\/ Larger Name\n  let largerFont = Font.title1()\n  const largeNameStack = leftContainerStack.addStack()\n  const largeName = largeNameStack.addText(settings.FRIENDLY_NAME)\n  largeName.font = largerFont\n  largeName.textColor = new Color('#ffffff')\n  \/\/ CHART IMAGE\n  largeNameStack.addSpacer(50)\n  const chartUrl = encodeURI(await getChartUrl(percentChange));\n  const chartImgReq = new Request(chartUrl)\n  const chartImage = largeNameStack.addImage(await chartImgReq.loadImage())\n  chartImage.imageSize = new Size(75, 35)\n  chartImage.url = settings.CHART_URL + settings.CONTRACT_ADDRESS\n  \/\/ TOKEN IMAGE\n  const headerImageStack = rightContainerStack.addStack()\n  let tokenImage = headerImageStack.addImage(tokenImg)\n  tokenImage.imageSize = new Size(40, 40)\n  tokenImage.url = settings.WIDGET_URL\n  \/\/ Large Wallet Bal\n  let largeFont = Font.title2()\n  const largeBalanceStack = leftContainerStack.addStack()\n  let formattedBalance = formatNumber(walletBalance.toString().split('.')[0]) + '.' + walletBalance.toString().split('.')[1]\n  const largeBalance = largeBalanceStack.addText(formattedBalance)\n  largeBalance.font = largeFont\n  largeBalance.textColor = new Color('#ffffff')\n  \/\/ BOTTOM LEFT STACK:\n  \/\/ **************************************\n  \/\/ Small Price\n  let smallFont = Font.body()\n  const smallPriceStack = leftContainerStack.addStack()\n  const smallPrice = smallPriceStack.addText('@ ' + (price).toString())\n  smallPrice.font = smallFont\n  smallPrice.textColor = new Color('#ffffff')\n  \/\/ Small Bal\n  const smallBalanceStack = leftContainerStack.addStack()\n  const smallBalance = smallBalanceStack.addText('$' + formatNumber(balance))\n  smallBalance.font = Font.title2()\n  smallBalance.textColor = new Color('#ffffff')\n  \/\/ Small Percent\n  let changeIsUp = percentChange > 0\n  percentChange = (percentChange * (changeIsUp ? 1 : -1)).toString()\n  const smallPercent = smallPriceStack.addText((changeIsUp ? ' ▲' : ' ▼') + ' (' + percentChange + '%)')\n  smallPercent.font = smallFont\n  smallPercent.textColor = (changeIsUp ? Color.green() : Color.red()) \n  let now = Date.now()   \n  \/\/ Smaller last update\n  const smallUpdated = leftContainerStack.addText('Updated: ' + formatDate(new Date(now)))\n  smallUpdated.font = Font.caption2()\n  smallUpdated.textColor = Color.gray()\n  \/\/ **************************************\n  \/\/refresh widget automatically\n  let nextRefresh = now + 1000\n  w.refreshAfterDate = new Date(nextRefresh)\n  showGradientBackground(w)\n  return w\n}\nfunction showGradientBackground(widget) {\n  let gradient = new LinearGradient()\n  gradient.colors = [new Color('#0a0a0a'), new Color('#141414'), new Color('#1f1f1f')]\n  gradient.locations = [0,0.8,1]\n  widget.backgroundGradient = gradient\n}\n\nasync function getBSCPrice(pair) {\n  let ticker = {};\n  let requestUrl = settings.TICKER_API_URL + '\/' + pair;\n  try {\n    let request = new Request(requestUrl)\n    request.method = 'get';\n    ticker = await request.loadJSON()\n  } catch (e) {\n    console.log(e)\n  }\n  return ticker;\n}\n\nasync function getKline(pair) {\n  let kline = {};\n  let requestUrl = settings.KLINE_API_URL.replace('{0}', pair);\n  try {\n    let request = new Request(requestUrl)\n    request.method = 'get';\n    kline = await request.loadJSON()\n  } catch (e) {\n    console.log(e)\n  }\n  return kline;\n}\n\nasync function getBSCWallet(contract, walletAddress) {\n  let requestUrl = settings.BSCSCAN_API_URL\n    .replace('{0}', contract)\n    .replace('{1}', walletAddress)\n    .replace('{2}', settings.BSCSCAN_API_KEY);\n  let walletBalance = 0;\n  try {\n    let request = new Request(requestUrl)\n    request.method = \"get\";\n    let response = await request.loadJSON()\n    walletBalance = parseFloat(response['result']) * settings.PRICE_FACTOR\n  } catch (e) {\n       console.log(e)\n  }\n  return walletBalance\n}\n\nasync function getBalance() {\n  let walletBalance = await getBSCWallet(settings.CONTRACT_ADDRESS, settings.WALLET_ADDRESS)\n  let ticker = await getBSCPrice(settings.CURRENCY_PAIR)\n  let balance = {\n      balance: (walletBalance * ticker['last']).toFixed(2),\n      last: ticker['last'],\n      walletBalance: walletBalance,\n      percentChange: ticker['percentChange']\n    }\n  return balance\n}\n\nfunction formatNumber(num) {\n  return num.toString().replace(\/(\\d)(?=(\\d{3})+(?!\\d))\/g, '$1,')\n}\n\nfunction formatDate(date) {\n  const dF = new DateFormatter()\n  dF.dateFormat = 'MM\/dd\/yy h:mm:ss a'\n  return dF.string(date)\n}\n\nasync function getChartUrl(percentChange) {\n  let kline = await getKline(settings.CURRENCY_PAIR);\n  let x = [];\n  let y = [];\n  let baseline = [];\n  let min = 0\n  let max = 0;\n  for (var i=0; i<kline.data.length; i++) {\n    var p = kline.data[i];\n    var d = new Date(parseInt(p[0])).toLocaleDateString(\"en-US\");\n    var t = new Date(parseInt(p[0])).toLocaleTimeString(\"en-US\");\n    x.push(d+' '+t);\n    y.push(parseFloat(p[5]));\n    baseline.push(parseFloat(kline.data[0][5]));\n  }\n  min = Math.min(...y)\n  max = Math.max(...y)\n  let chartObj = {\n    \"type\": \"line\",\n    \"data\":\n    {\n      \"labels\": x,\n      \"datasets\": [\n        {\n          \"borderColor\": percentChange > 0 ? 'green' : 'red',\n          \"data\": y,\n          \"fill\": 0\n        },\n        {\n          backgroundColor: 'transparent',\n          \"borderWidth\": 10,\n          \"borderDash\": [3, 6],\n          \"borderColor\": \"lightgray\",\n          \"data\": baseline\n        }\n      ]\n    },\n    \"options\":\n    {\n      \"responsive\": 1,\n      \"title\":\n      {\n        \"display\": 0\n      },\n      \"legend\":\n      {\n          \"display\": 0\n      },\n      \"elements\":\n      {\n        \"point\":\n        {\n          \"radius\": 0\n        }\n      },\n      \"scales\":\n      {\n        \"xAxes\": [\n        {\n        \"scaleLabel\": {\n          \"display\": 0,\n        },\n        \"gridLines\": {\n          \"display\": 0\n        },\n        \"ticks\":\n          {\n            \"display\": 0\n          }\n        }],\n        \"yAxes\": [\n        {\n          \"display\": 0,\n          \"ticks\":\n          {          \n            \"min\": min,\n            \"max\": max\n          }\n        }]\n      }\n    }\n  }\n  let chartUrl = settings.CHART_API_URL + JSON.stringify(chartObj)\n  return chartUrl\n}\n",
  "share_sheet_inputs" : [

  ]
}
